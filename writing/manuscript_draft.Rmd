---
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: true
fontsize: 11pt
geometry: margin=0.75in
bibliography: White_bib.bib
header-includes: 
    \usepackage{float}
    \usepackage{setspace}             
    \usepackage{lineno}
    \usepackage[round]{natbib}
    \bibpunct[; ]{(}{)}{,}{a}{}{;}
    \linenumbers
---


\begin{spacing}{1.5} %use 2
	\begin{flushleft}
Running head: 
\vspace{3 mm}

Title: Your time series is (probably) too short
\vspace{7 mm}

Author(s): \textsc{Easton R. White$^{1,2}$} 
\vspace{3 mm}

Addresses: \\ \emph{$^1$ Center for Population Biology, University of California-Davis, Davis, California 95616 USA}
\vspace{3 mm}

$^2$Corresponding author: eawhite@ucdavis.edu
\vspace{3 mm}

Number of words: X,XXX 
\vspace{3 mm}

To be submitted to: \emph{XXXXX} (Article)
\vspace{3 mm}

Keywords: 

\vspace{3 mm}

\end{flushleft}
\end{spacing}


\linenumbers

\clearpage
 

## Abstract
Long-term census data is necessary to better understand ecological processes and make management decisions. In addition, census data is often expensive, requiring a lot of people-hours or equipment. However, little work has actually addressed the length of time series required. In other words, when is a time series of census data long enough to address a question of interest? Here, I explore two approaches to address this question: one simulation-based and an empirical approach. I specifically determine the minimum time series length required to estimate significant increases or decreases in population abundance. Importantly, I examine the ability to detect a trend with a set level of statistical power, which is often neglected in ecological time series analyses. Using simple simulations, I demonstrate how the minimum time series length required increases with weaker trends in abundance and with higher variability in population size. In addition, I examine 868 populations of vertebrate species to determine the minimum time required to detect changes in their abundance. Here I show 10-15 years of continuous monitoring are required in order to achieve a high level of statistical power. Similar to simulation-approaches, the minimum time required for field census data strongly depends on trend strength, population variability, and temporal autocorrelation. Perhaps surprisingly, the minimum time required did not correlate well with biological explanatory variables, like body size or generation length. These results point to the importance of sampling populations over long periods of time. Here, I stress the need for verifying a study has enough statistical power to accurately determine long-term changes in population abundance. Most studies, especially those less than 10-15 years, are probably under-powered and potentially misleading.

## Introduction 

- intro long time series
- my general question
- primer on power
- more general power interpretation
- 2+ approaches
- what we do in this paper


Observational studies, and censusing populations, has become a cornerstone of modern ecology and conservation biology [@Magurran2010]. Longterm data is necessary to understand population dynamics and to assess extinction risk of species. Even though many time series may now be considered "longterm", most are still short (i.e. less than X years). *I could have statistic on how long is considered "longterm" in papers*. Time series are typically short for a variety of reasons. They are often coupled with an experiment, which may only last a couple of years. In addition, short funding cycles make it difficult to examine populations over longer periods of time. There are of course notable exceptions including the Isle Royale study, Iowa corn study, cod, lynx-hair, and many others.  

Naturally, one might ask, how long of a time series is actually necessary? This question has important scientific and management implications. Scientifically, we need to know how long a time series is required to address a specific question. Too short of a time series may lead to wrong conclusions given large natural year-to-year variability. From a management perspective, it is important to understand when a trend in abundance over time is actually meaningful or not. For instance the International Union for the Conservation of Nature (IUCN) suggest...In addition, because sampling is typically expensive, we do not want to over sample [@Gerber1999].

In determining the number of samples required for a particular experiment four quantities are intricately linked: statistical power, effect size, alpha, sample size [@Legg2006]. The exact relationship between these quantities depends on the specific statistical test. Formally, statistical power is one minus the probability of a type II error, or false negative. In other words, it is a measure of how well you could detect a trend given it is actually significant. Prior to an experiment, one could set appropriate levels of power, $\alpha$, and the effect size to estimate the sample size required for the experiment. This approach, however, is not as simple for a time series as the data points are clearly non-independent. 

For time series data, two general approaches can be used. First, as can be done with experimental data, we can relax the definition of statistical power (cite Bolker). Instead of using classic statistical tests (e.g. t-test), and corresponding power calculations, simulation approaches can be used [@Gerrodette1987]. Simple population models can be simulated with parameter values corresponding to a population of interest. Out of a large number of simulations, power can be calculated as the fraction of simulations that meet some criteria. The specific criteria depend on the question at hand. Then one can run simulations for time series of different lengths to determine the minimum time series length required to be confident that you will be able to answer your question. In addition to using simulated data, empirical time series can also be used. We usually do not have multiple replicates of similar populations, but we can subsample an empirical time series. Subsamples of different lengths can then be evaluated to see which fraction of subsamples meet some criteria, again a measure of statistical power...

Past work has investigated these questions with either theoretical approaches not using data or by examining a single population. As an example of the former, [@Rhodes2011] examined..

In this paper, we use both simulations and a database of empirical time series to determine the minimum number of years required to address various questions. To demonstrate these techniques, we address three specific questions: (1) what is the minimum time series length required to identify significant changes over time using linear regression, (2)
<!-- In this paper, we evaluate the minimal time series length required to answer X questions. 1) How sensitivive are IUCN asssessments to time series lengths? 2) What minimum time series length is required to measure the entire time series trend? 3) How long does a time series need to be to measure the variance in population size (rare event questions)? We demonstrate our approach with X case studies and then show results for X species from the Blah Blah Database.  -->

## Methods

### Theoretical approach

One approach to determining the minimum time series needed is through repetitive simulations of a population model [@Gerrodette1987]. This is the same approach one might use in sample size calculations for any experimental design too complicated for simple power analyses [@Johnson2015]. We only briefly discuss this approach as it has been desribed elsewhere (citations). Essentially, we take a stochastic population model and simulate it for a number of years repetitively. We can then determine the minimum time series required to achieve designed levels of significance and power. This approach requires us to determine values for our model parameters. As an example, we can take the following population model for population size $N$ at time $t$:
$$
N(t + 1) = N(t) + r(t) \mbox{ with } r(t) \sim N(\phi \mu, \sigma)
$$
where $\epsilon$ is a normally-distributed random noise term with mean $\mu$ and standard deviation $\sigma$. The rate of growth $r$ is also the trend strength of increase or decrease. Lastly, $\phi$ represents an autocorrelation term where $\phi=0$ indicates no autocorrelation, $\phi>0$ is positively autocorrelated. This model represents linear growth with autocorrelation and noise. However, it is certainly possible to use any other population model.

By simulating this model repetitively for different lengths of time, we can determine the minimum time series required. Here statistical power is simply the number of trials that are themselves significant, as the real trend is different from zero. Then the minimum time required is the minimum time required to obtain statistical power above some pre-determined threshold. Historically, 0.8....s

In figure X, a number of simulated time series are shown for a set number of time periods (t=40). It is clear that statistical power increases quickly with increases in $t$ (Fig. Xb). Once power is greater than XX (the dotted line), that is the minimum time required ($t_{min}$

<!--
![optional caption text](example_theoretical_output.pdf)
-->


```{r,echo=F,fig.cap='theoretical approach\\label{fig:theoretical_approach}'}
setwd("~/Desktop/Research/time-series-project")
source("scripts/theoretical-models/calculate_power.R")
source("scripts/theoretical-models/simulate_pop.R")


  years_to_sample=seq(2,100,by=1)
  power=lapply(X=years_to_sample,FUN = calculate_power,phi = 0.6,r=0.2,sigma = .5,trials=50)#should use 300 trials
  
  simulations = replicate(n=30,simulate_pop(phi = 0.6,r=0.2,sigma = .5,max.time=40))
  min_time_needed = years_to_sample[tail(which(power<0.8),1)] + 1

  # Plotting commands
  par(mfrow=c(1,2),oma=c(1,2,0,0.5),mar=c(4,5,0.5,0.5))
    matplot(simulations,type='l',col=rgb(0.5,0.5,0.5,0.5),lty=1,ylab='',xlab='',las=1,cex.axis=1.2)
      mtext(text = 'time' ,side = 1,cex = 1.2,line=3)
      mtext(text = 'population size' ,side = 2,cex = 1.2,line=4)
  
    plot(years_to_sample,power,type='l',lwd=2,las=1,ylab='',xlab='',cex.axis=1.2)
      abline(v=min_time_needed,lty=2,lwd=2,col='red')
      abline(h=0.8,lty=2,lwd=2,col='red')
      mtext(text = 'time sampled' ,side = 1,cex = 1.2,line=3)
      mtext(text = 'statistical power' ,side = 2,cex = 1.2,line=3.5)

```


```{r, echo=F}
# Pull in original database from Keith et al. 2015 and the cleaned version after our series of filtering steps
 setwd("~/Desktop/Research/time-series-project")
#Load keith database
load('data/Keith_et_al_2015_data.Rdata')

#Load our cleaned data
load('cleaned-data/pop_info_example_goodNAs.Rdata')
```

### Data source
We use a database of `r length(table(dat$ID))` population time series compiled in [@Keith2015]. The data is originally from the Global Population Dynamics Database [@GPDD2010]. We filtered out short time series (less than `r pop_info$series_length[1]`) and were left with `r nrow(pop_info)` time. The database includes information on `r length(table(pop_info$Binomial))` vertebrate species with a focus on mammals, birds, and fish. The database also includes information on generation length and census specifications. For each time series, we also calculated variables of interest like variance in population size, longterm trend in abundance (slope coefficient from simple linear regression), and temporal autocorrelation. Lastly, we also calculated the minimum number of years required to sample according to IUCN standards under rule ... (citation needed).

For a subset of populations in the database (X = XX), we were able to connect a database on biological characteristics like body size and generation length. We used 



### Empirical approach

Our objective is to determine the minimum time series length ($T_{min}$) required to answer a specific question of interest. As we describe below, the minimum time series length calculation is particular to each question. Intuitively, we might expect a longer minimum time series length required given more complicated questions.

We assume that each time series in our database are long enough to include all necessary information (e.g. variability) about the population. In other words, they are a Representative sample. We first take all possible contiguous subsamples of each time series. For example, a time series of 40 years would have 39 possible contiguous subsamples of length 2, 38 possible contiguous subsamples of length 3, and so forth. In this paper, we will try to ask a simple, specific question. We seek to determine the $T_{min}$ required to be confident in an estimate of the slope coefficient from linear regression. Therefore, we run a linear regression for each subsampled time series. Then, we determine the fraction of subsamples of a particular length that have slopes from linear regression which are statistically different from zero given the longterm, or ``true", time series also has a significant slope. This is a measure of statistical power. Lastly, we determine which subsample length is required to guarantee we have above a certain threshold of statistical power, which here we will assume is 0.8 by convention (citation).

We also examine how minimum time series calculations changed depending on the question of interest. In the supplementary material, we show how to make similar calculations to determine the minimum time series required to estimate overall population growth rate, the variability in population size, and future extinction risk.

In the appendix, we explore other potential questions of interest...

```{r, echo=F,message=F,warning=F}
# Example of subsampling empirical data
setwd("~/Desktop/Research/time-series-project")
 load("cleaned-data/pop_info_example_goodNAs.Rdata")
 par(mfrow=c(1,2))
pop = subset(long_dat,long_dat$ID=='10696') #13192 for Harp seals
plot(pop$year,pop$popvalue,cex.axis=1.2,cex.lab=1.2,ylab='population size',xlab='time (years)',pch=16,ylim=c(0,2000),las=1)
abline(lm(pop$popvalue~pop$year),lwd=2,col='red')
# could insert all possible regressions of length n
source('scripts/calculate_power_metric.R')
power_example=calculate_power_for_subsamples(pop$popvalue,0.05)
plot(power_example,cex.axis=1.2,cex.lab=1.2,ylab='average statistical power',xlab='years sampled',las=1,pch=16)
# could also insert standard error bars
abline(h=0.8,col='red',lwd=2,lty=2)
abline(v=22,col='red',lwd=2,lty=2)

```



<!--Question 2: How sensitive are IUCN assessments to time series trends?
The IUCN sets threat statuses for a variety of species. Importaly, they have a threshold of 10 years or 3 generation. Therefore, we subsampled all possible 10-year, or greater, time series for each population. For example, species X has been sampled for 40 years. This would lead to XX possible 10-year time series. We then determined what percentage of these 10 year, or greater, time series would lead to the wrong conculsions compared to the full time series.

Question 3: How long does a population need to be sampled to capture the variability in population size?

Populations vary from year-to-year for several reasons including-->




## Results

- summary of findings
- theoretical approach
  - example plot
- empirical approach
  - plots: distribution of min time, what min time correlations with
  - walk through one empirical example (maybe in appendix)

We evaluated the question of what minimum time series is required to answer a question of interest. More specifically we ask, what is the minimum time series length required to determine, via linear regression, the longterm trend in population abundance? The minimum time series length required is that which had high enough statistical power. We investigated this question through two approaches: simulation-based and empirical analyses. In both cases, we found the minimum time series length required depended strongly on the trend strength, population variability, and autocorrelation.


### Simulation approach

We constructed a general population model where the trend over time could be a model parameter. We chose a simple model, but any other population model could be used. The specific model choice should be tailored to the population of interest, based on species ecology. We then ran simulations of different lengths to determine the minimum time series length required to achieve a certain level of power (which we set to 0.8). We were also able to alter the parameter values (trend strength and population variability) of the population model to see how this altered $T_{min}$. 

In line with past work, we found the $T_{min}$ increases (i.e. more time is required) with decreases in trend strength or autocorrelation and with increases in variability (citation). 


### Empirical test

```{r,echo=F,fig.cap='Distribution of the minimum time required in order to detect a significant trend (at the 0.05 level) in abundance given power of 0.8.\\label{fig:fig:min_time_dist}'}
# Pull in analysis of average min time needed for **empirical species** (save analysis as Rdata file or something)
 setwd("~/Desktop/Research/time-series-project")
 load("cleaned-data/pop_info_example_goodNAs.Rdata")

#only look at pops with significant longterm declines or increases
pop_info=pop_info[pop_info$trend_p_value<0.05,]
long_dat=subset(long_dat,long_dat$ID %in% pop_info$ID)
long_time_names=subset(long_time_names,long_time_names %in% pop_info$ID)

plot(density(pop_info$min_time_for_power),las=1,ylab='',xlab='',cex.axis=1.2,main='')
mtext(text = 'Frequency',2,line=3,cex=1.2)
mtext(text = 'Minimum time required',1,line=3,cex=1.2)
```

 

```{r poisson_model, echo=F}
#Poisson regression
pop_info$abs_overall_trend = abs(pop_info$overall_trend)
poisson_model <-glm(min_time_for_power~ abs_overall_trend + autocorrelation + variance + gen_len,family = 'poisson',data=pop_info)
par(mfrow=c(2,2),mar=c(5,5,1,2),oma=c(0,0,0.5,0))
#plot(poisson_model,cex.lab=1.2,las=1,cex.axis=1.2,main=' ')

#R^2 calculation (pg. 218 Zuur)
R2 <- 100*(poisson_model$null.deviance - poisson_model$deviance)/(poisson_model$null.deviance)

```



```{r,echo=F,fig.cap='duh\\label{fig:correlates}'}

# Plot minimum time required against trend strength, population variance, and autocorrelation  
  par(mfrow=c(3,1),mar=c(4,1,1,1),oma=c(0,4.5,0,0.5))
  plot(abs(pop_info$overall_trend),pop_info$min_time_for_power,pch=16,col=rgb(0.5,0.5,0.5,0.5),las=1,ylab='',xlab='',cex.axis=1.2)
  mtext('| trend strength |',1,line=3,cex=1.2)
    plot(pop_info$variance,pop_info$min_time_for_power,pch=16,col=rgb(0.5,0.5,0.5,0.5),las=1,ylab='',xlab='',cex.axis=1.2)
    mtext('population variance',1,line=3,cex=1.2)
      plot(pop_info$autocorrelation,pop_info$min_time_for_power,pch=16,col=rgb(0.5,0.5,0.5,0.5),las=1,ylab='',xlab='',cex.axis=1.2)
      mtext('autocorrelation',1,line=3,cex=1.2)
      
       mtext('minimum time required',2,line=2.5,cex=1.2,outer = T)

  
  
```

We examined a database of `r nrow(pop_info)` separate population time series representing `r length(table(pop_info$Binomial))` species. This database consists of species with a variety of life history characteristics. We limited our analyses to populations with at least 35 years of continuous sampling.

Across all the populations we examined, we found an average minimum time series length required ($T_{min}$) of `r mean(pop_info$min_time_for_power)` ($\sigma$=`r (var(pop_info$min_time_for_power))^0.5`), with a wide distribution (Fig. \ref{fig:min_time_dist}). As expected based on theoretical results (cite papers), the minimum time series length required is strongly correlated with trend strength, population variance, and autocorrelation (Fig \ref{fig:correlates}). Using a generalized linear model, with a Poisson error structure, all three of these explanatory variables were significant and had large effect sizes (cite model here). Combined trend strength, population variance, and autocorrelation account for about `r 100*(poisson_model$null.deviance - poisson_model$deviance)/(poisson_model$null.deviance)` of the variance in minimum time series length required (as proposed by CITE Zuur).

We also examined a subset of populations where more explanatory variables were known (e.g. body mass, longevity, location). None (need to do regression) of these explanatory variables were predictive of the minimum time series length required. Some differences if $t_{min}$ did occur between biological classes, but this can be attributed to the amount populations are know to fluctuate. 

    
```{r,echo=F}
# Biological correlates plots
par(mfrow=c(2,2),mar=c(4,5,0.5,0.5))

boxplot(pop_info$min_time_for_power~pop_info$class, lwd = 1, ylab = 'minimum time required',col='white',cex.lab=1.4,cex.axis=1.2,las=1)
stripchart(pop_info$min_time_for_power~pop_info$class, vertical = TRUE,method = "jitter", add = TRUE, pch = 20, col = rgb(0.5,0.5,0.5,0.5))

boxplot(abs(pop_info$overall_trend)~pop_info$class, lwd = 1, ylab = ' ',col='white',cex.lab=1.4,cex.axis=1.2,las=1)
stripchart(abs(pop_info$overall_trend)~pop_info$class, vertical = TRUE,method = "jitter", add = TRUE, pch = 20, col = rgb(0.5,0.5,0.5,0.5))
  mtext('| trend strength |',2,line=3.5,cex=1.2)
  
boxplot(pop_info$variance~pop_info$class, lwd = 1, ylab = 'population variance',col='white',cex.lab=1.4,cex.axis=1.2,las=1)
stripchart(pop_info$variance~pop_info$class, vertical = TRUE,method = "jitter", add = TRUE, pch = 20, col = rgb(0.5,0.5,0.5,0.5))

boxplot(pop_info$autocorrelation~pop_info$class, lwd = 1, ylab = 'autocorrelation',col='white',cex.lab=1.4,cex.axis=1.2,las=1)
stripchart(pop_info$autocorrelation~pop_info$class, vertical = TRUE,method = "jitter", add = TRUE, pch = 20, col = rgb(0.5,0.5,0.5,0.5))
```

```{r,echo=F}
par(mfrow=c(1,1))
  plot(pop_info$gen_len,pop_info$min_time_for_power,pch=16,col=rgb(0.5,0.5,0.5,0.5),las=1,ylab='',xlab='',cex.axis=1.2)
  mtext('generation time (years)',1,line=3,cex=1.2)
  mtext('minimum time required',2,line=2.5,cex=1.2,outer = F)
```
    


```{r,echo=F,eval=F}
#summary(poisson_model)
```

<!--
## Potential figures
- Examples of how determining minimum time series works (probably in methods)
- What min time should scale with theoretically (trend, power, variability, etc) - another multi panel figure
- Mean min time by class or system
- Separate results for species, body size, location, biology. - multi panel figure

-->

## Discussion

<!-- 
- Findings and how they relate to past work
- Extensions to other systems. Useful to use similar species
- Biological variables not good predictors, but we also used all long-lived vertebrate species
- Other questions to ask and results in appendix
- Future recommendations to others and future work
- implications
- conclusion paragraph

The IUCN has an 10 year/3 generation rule... If we apply this rule to the species in our database we see that approximately `r 100*sum(pop_info$min_time_for_power>pop_info$IUCN)/nrow(pop_info)`% of populations need a longer minimum time series than that required by IUCN.
-->

We show two different approaches to estimate the minimum time series length required required to address a particular question of interest. The simulation-based approach has been suggested by others, especially in situations where analysis is more complicated than a simple power analysis [@Gerrodette1987]. We focus on a empirical approach to estimate the minimum time series length requried. 

The first question we asked was, what is $t_{min}$ for determining whether a population was increasing or decreasing over time according to linear regression. We found that for `r nrow(pop_info)` populations, at least 10-15 years of continuous monitoring were neccessary. In line with theoretical predictions (citations), we also found $t_{min}$ was strongly correlated with the trend strength, variability in population size, and temporal autocorrelation.

There have been previous attempts to address how long a time series should be to assess trends in abundance. For example,...


### Limitations

Our work has obvious limitations in determining the minimum time series length required. First, $t_{min}$ depends strongly on the question being asked and the availability of long-term census data. For our empirical approach, the subsampling of the full time series allows for estimates of power, but the individual subsamples are clearly not independent of one another. (sentence about alpha and power limititations here) The perfect scenario would be to have a population model built and parameterized for each population of interest. Then, model simulations could be used to estimate the minimum time series reuqired to address a specific question of interest. Clearly, this is not always practical, especially if running analyses for a wide array of species as we do here. In addition, our statistical models suggest that $t_{min}$ does not correlate with any biological variables of interest, at least for the question of linear regression. Therefore, it is not possible to use these results to predict $t_{min}$ for another population, even if the population is of a species with a similar life-history to one in our database. 

### Conclusions

- what we found, implications, future work

We use a database of `r nrow(pop_info)` populations to determine the minimum time series length required. We show that to assess longterm trends in abundance, 10-15 years of continuos monitoring are required. In line with theoretical predictions, we also show that $t_{min}$ is strongly correlated with the overall trend in abundance, variability in abundance, and the temporal autocorrelation. Our work implies that for many populations, census data less than 10-15 years are probably not reliable. This stresses the importance of longterm monitoring programs. (where do IUCN recommendations come from?) From both a scientific and management perspective estimates of $t_{min}$ are important. If a time series is too short, we are likely to make incorrect conclusions about longterm trends. In addition, a time series that is too long may have been a poor use of scare funds. Future work can examine other species, with a wider range of life history characteristics, or address other questions besides longterm trends in abundance. 

### Time series length recommendations from other papers

- greater than 5 years [@Morrison2008]
- more than 10-15 years [@Rueda-Cediel2015]
- general advice (variability, correlations) [@Rhodes2011]
- more than 10 years [@Gerber1999]
- specific recommendations depend on amount of power and strength of trend (Bart 2004, Hatch 2003) [@Seavy2007]

## References



